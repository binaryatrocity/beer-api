<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>app.routes &mdash; beer-api  documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="beer-api  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">beer-api  documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for app.routes</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">get_flashed_messages</span><span class="p">,</span>\
        <span class="n">g</span><span class="p">,</span> <span class="n">make_response</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="kn">import</span> <span class="n">OperationalError</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">auth</span>
<span class="kn">from</span> <span class="nn">app.models</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Glass</span><span class="p">,</span> <span class="n">Beer</span><span class="p">,</span> <span class="n">Review</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/token&#39;</span><span class="p">)</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="get_auth_token"><a class="viewcode-back" href="../../app.html#app.routes.get_auth_token">[docs]</a><span class="k">def</span> <span class="nf">get_auth_token</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Generates an authentication token for current user.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/token</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:**  Password Only</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">generate_auth_token</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span> <span class="s">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">)</span> <span class="p">})</span>

<span class="c"># User model routes</span></div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="list_users"><a class="viewcode-back" href="../../app.html#app.routes.list_users">[docs]</a><span class="k">def</span> <span class="nf">list_users</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; List all users in the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** sort_by=&lt;column name&gt; &lt;desc?&gt;</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Examples:</span>

<span class="sd">    *Get list of users* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/users</span>

<span class="sd">    *Sorted by creation date* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/users?sort_by=created_on</span>
<span class="sd">    </span>
<span class="sd">    *Sorted by username descending* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/users?sort_by=username%20desc</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sort_by&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">OperationalError</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid sorting value specified&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">])</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="get_user"><a class="viewcode-back" href="../../app.html#app.routes.get_user">[docs]</a><span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Retrieve information about a particular user.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users/&lt;user_id&gt;</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Example:</span>

<span class="sd">    *Get data for user with id# 5*  ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/users/5</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users/&lt;int:id&gt;/reviews&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="get_user_reviews"><a class="viewcode-back" href="../../app.html#app.routes.get_user_reviews">[docs]</a><span class="k">def</span> <span class="nf">get_user_reviews</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return list of reviews authored by a particular user.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users/&lt;user_id&gt;/reviews</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** sort_by=&lt;column_name&gt; &lt;desc&gt;</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Example:</span>

<span class="sd">    *Get reviews for user with id# 2* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/users/5/reviews</span>

<span class="sd">    *Get reviews for user with id# 1 sorted by aroma* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/users/5/reviews?sort_by=aroma</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sort_by&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span>\
                    <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">reviews</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">sort</span><span class="p">)])</span>
        <span class="k">except</span> <span class="n">OperationalError</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid sorting value specified&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">reviews</span><span class="p">])</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="create_user"><a class="viewcode-back" href="../../app.html#app.routes.create_user">[docs]</a><span class="k">def</span> <span class="nf">create_user</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Creates a new user and saves it to the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users</span>
<span class="sd">    |  **Method:** POST</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** None</span>
<span class="sd">    |  **Expected Data:** username, password</span>
<span class="sd">    |  **Optional Data:** email</span>

<span class="sd">    Example:</span>

<span class="sd">    *Create user &#39;john&#39; with password &#39;suchsafety&#39; and email &#39;john@inter.net&#39;* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/users</span>
<span class="sd">      data={&quot;username&quot;:&quot;john&quot;, &quot;email&quot;:&quot;john@inter.net&quot;, &quot;password&quot;:&quot;suchsafety&quot;}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;username&#39;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;email&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;password&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Missing required field (username/password)&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Username already exists&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;User created successfully&#39;</span><span class="p">}),</span>\
            <span class="mi">201</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;Location&#39;</span><span class="p">:</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&#39;get_user&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">_external</span><span class="o">=</span><span class="bp">True</span><span class="p">)}</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="edit_user"><a class="viewcode-back" href="../../app.html#app.routes.edit_user">[docs]</a><span class="k">def</span> <span class="nf">edit_user</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Allows editing of a user in the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users/&lt;user_id&gt;</span>
<span class="sd">    |  **Method:** PUT</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>
<span class="sd">    |  **Optional Data:** email, username, password</span>

<span class="sd">    Example:</span>

<span class="sd">    *Edit user with id#1, change email to &#39;john@newisp.com&#39;* ::</span>

<span class="sd">      PUT http://domain.tld/beer/api/v0.1/users/1</span>
<span class="sd">      data={&quot;email&quot;:&quot;john@newisp.com&quot;}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;email&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;password&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;User with new username already exists&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="n">u</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
    <span class="k">if</span> <span class="n">email</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;User with that email already exists&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="n">u</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
    <span class="k">if</span> <span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">u</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">hash_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;User updated successfully&#39;</span><span class="p">,</span> <span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">serialize</span><span class="p">()})</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="delete_user"><a class="viewcode-back" href="../../app.html#app.routes.delete_user">[docs]</a><span class="k">def</span> <span class="nf">delete_user</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Delete a user from the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users/&lt;user_id&gt;</span>
<span class="sd">    |  **Method:** DELETE </span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>

<span class="sd">    Example:</span>

<span class="sd">    *Delete user with id# 4* ::</span>

<span class="sd">      DELETE http://domain.tld/beer/api/v0.1/users/4</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;User deleted successfully&#39;</span><span class="p">})</span>



<span class="c"># Glass model routes</span></div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/glasses&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="list_glasses"><a class="viewcode-back" href="../../app.html#app.routes.list_glasses">[docs]</a><span class="k">def</span> <span class="nf">list_glasses</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; List glass types in the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/glasses</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** sort_by=&lt;column name&gt; &lt;desc&gt;</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Example:</span>

<span class="sd">    *List all glass styles in the database* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/glasses</span>

<span class="sd">    *List glass styles by name descending* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/glasses?sort_by=name%20desc</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sort_by&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">glasses</span> <span class="o">=</span> <span class="n">Glass</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">OperationalError</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid sorting value specified&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">glasses</span> <span class="o">=</span> <span class="n">Glass</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">glasses</span><span class="p">])</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/glasses/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="get_glass"><a class="viewcode-back" href="../../app.html#app.routes.get_glass">[docs]</a><span class="k">def</span> <span class="nf">get_glass</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get data about a particular glass in the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/glasses/&lt;glass_id&gt;</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Example:</span>

<span class="sd">    *Get data about glass with id# 3* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/glasses/3</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Glass</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/glasses&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="create_glass"><a class="viewcode-back" href="../../app.html#app.routes.create_glass">[docs]</a><span class="k">def</span> <span class="nf">create_glass</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Add a new glass type to the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/glasses</span>
<span class="sd">    |  **Method:** POST</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>
<span class="sd">    |  **Expected Data:** name</span>

<span class="sd">    Example:</span>

<span class="sd">    *Create a glass-type with name &#39;tumbler&#39;* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/glasses</span>
<span class="sd">      data={&quot;name&quot;:&quot;tumbler&quot;}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;name&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Missing required field (glass name)&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Glass</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Glass-type already exists&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">glass</span> <span class="o">=</span> <span class="n">Glass</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">glass</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="n">glass</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span>\
            <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Glass-type created successfully&#39;</span><span class="p">}),</span> <span class="mi">201</span><span class="p">,</span>\
            <span class="p">{</span><span class="s">&#39;Location&#39;</span><span class="p">:</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&#39;get_glass&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">glass</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">_external</span><span class="o">=</span><span class="bp">True</span><span class="p">)}</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/glasses/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="edit_glass"><a class="viewcode-back" href="../../app.html#app.routes.edit_glass">[docs]</a><span class="k">def</span> <span class="nf">edit_glass</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Edit the name of a glass-type.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/glasses/&lt;glass_id&gt;</span>
<span class="sd">    |  **Method:** PUT</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>

<span class="sd">    Example:</span>

<span class="sd">    *Rename glass with id# 2 to &#39;Goblet&#39;* ::</span>

<span class="sd">      PUT http://domain.tld/beer/api/v0.1/glasses/2</span>
<span class="sd">      data={&quot;name&quot;:&quot;Goblet&quot;}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">Glass</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Glass</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Glass with that name already exists&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Glass-type updated successfully&#39;</span><span class="p">,</span>\
            <span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">serialize</span><span class="p">()})</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/glasses/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="delete_glass"><a class="viewcode-back" href="../../app.html#app.routes.delete_glass">[docs]</a><span class="k">def</span> <span class="nf">delete_glass</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Delete a glass-type from the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/glasses/&lt;glass_id&gt;</span>
<span class="sd">    |  **Method:** DELETE</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>

<span class="sd">    Example:</span>

<span class="sd">    *Delete glass-type with id# 5* ::</span>

<span class="sd">      DELETE http://domain.tld/beer/api/v0.1/glasses/5</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">Glass</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Glass deleted successfully&#39;</span><span class="p">})</span>




<span class="c"># Beer model routes</span></div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/beers&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="list_beers"><a class="viewcode-back" href="../../app.html#app.routes.list_beers">[docs]</a><span class="k">def</span> <span class="nf">list_beers</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; List all of the beers in the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/beers</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** sort_by=&lt;column_name&gt; &lt;desc&gt;</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Example:</span>

<span class="sd">    *List all beers in the system* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/beers</span>

<span class="sd">    *Sort beers by ABV%* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/beers?sort_by=abv</span>

<span class="sd">    *Sort beers by calories descending* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/beers?sort_by=calories%20desc</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sort_by&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">beers</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">OperationalError</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid sorting value specified&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">beers</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">beers</span><span class="p">])</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/beers/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="get_beer"><a class="viewcode-back" href="../../app.html#app.routes.get_beer">[docs]</a><span class="k">def</span> <span class="nf">get_beer</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get data about a particular beer.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/beers/&lt;beer_id&gt;</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Example:</span>

<span class="sd">    *Return data about beer with id# 5* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/beers/5</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/beers/&lt;int:id&gt;/reviews&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="get_beer_reviews"><a class="viewcode-back" href="../../app.html#app.routes.get_beer_reviews">[docs]</a><span class="k">def</span> <span class="nf">get_beer_reviews</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return list of reviews about a particular beer.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/beers/&lt;beer_id&gt;/reviews</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Example:</span>

<span class="sd">    *Retrieve list of reviews about beer with id# 2* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/beers/2/reviews</span>

<span class="sd">    *Get reviews of beer with id# 4 sorted by taste descending* ::</span>
<span class="sd">      </span>
<span class="sd">      GET http://domain.tld/beer/api/v0.1/beers/4/reviews?sort_by=taste desc</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">b</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sort_by&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span>\
                    <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span>  <span class="n">b</span><span class="o">.</span><span class="n">reviews</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">sort</span><span class="p">)])</span>
        <span class="k">except</span> <span class="n">OperationalError</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid sorting value specified&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">reviews</span><span class="p">])</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/beers&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<span class="c"># create_beer, now how do I hook this function into my fridge...</span>
<div class="viewcode-block" id="create_beer"><a class="viewcode-back" href="../../app.html#app.routes.create_beer">[docs]</a><span class="k">def</span> <span class="nf">create_beer</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Add a new beer to the database and return the object.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/beers</span>
<span class="sd">    |  **Method:** POST</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>
<span class="sd">    |  **Expected Data:** name, style, abv</span>
<span class="sd">    |  **Optional Data:** brewer, ibu, calories, brew_location, glass_type</span>

<span class="sd">    Example:</span>

<span class="sd">    *Create a beer named &#39;Mayan Chocolate&#39; by &#39;Mobcraft Beers&#39;, style &#39;Chocolate Chili Ale&#39;, abv 6.3%* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/beers</span>
<span class="sd">      data={&quot;name&quot;:&quot;Mayan Chocolate&quot;, &quot;style&quot;:&quot;Chocolate Chili Ale&quot;, &quot;brewer&quot;:&quot;Mobcraft&quot;, &quot;abv&quot;:6.4}</span>

<span class="sd">    *Create a beer named &#39;Riverwest Stein&#39; style &#39;Amber Lager&#39; abv 5.6% linked to glass_type 2* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/beers</span>
<span class="sd">      data={&quot;name&quot;:&quot;Riverwest Stein&quot;, &quot;glass_type&quot;:&quot;http://domain.tld/beer/api/v0.1/glasses/2&quot;, &quot;abv&quot;:5.6, &quot;style&quot;:&quot;Amber lager&quot;}</span>

<span class="sd">    *Create a beer named &#39;African Amber&#39; style &#39;Amber Ale&#39; abv 4.6% brewer &#39;Mac &amp; Jacks&#39; linked to glass_type 4* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/beers</span>
<span class="sd">      data={&quot;abv&quot;:5.6, &quot;style&quot;:&quot;Amber Lager&quot;, &quot;glass_type&quot;:4, &quot;name&quot;:&quot;African Amber&quot;}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">last_beer_added</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">last_beer_added</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c"># Beer already created in last 24 hours</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;You</span><span class="se">\&#39;</span><span class="s">ve already added a beer today.&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
    <span class="n">brewer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;brewer&#39;</span><span class="p">)</span>
    <span class="n">ibu</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ibu&#39;</span><span class="p">)</span>
    <span class="n">calories</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;calories&#39;</span><span class="p">)</span>
    <span class="n">abv</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;abv&#39;</span><span class="p">)</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">)</span>
    <span class="n">brew_location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;brew_location&#39;</span><span class="p">)</span>
    <span class="n">glass_type_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;glass_type&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">style</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">abv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Missing required field (name, style, abv)&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Beer already exists&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">beer</span> <span class="o">=</span> <span class="n">Beer</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">brewer</span><span class="p">,</span> <span class="n">ibu</span><span class="p">,</span> <span class="n">calories</span><span class="p">,</span> <span class="n">abv</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">brew_location</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">glass_type_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">Glass</span><span class="o">.</span><span class="n">id_or_uri_check</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">glass_type_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">gid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">beer</span><span class="o">.</span><span class="n">glass_type_id</span> <span class="o">=</span> <span class="n">gid</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">beer</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">last_beer_added</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="n">beer</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Beer created successfully&#39;</span><span class="p">}),</span>\
            <span class="mi">201</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;Location&#39;</span><span class="p">:</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;get_beer&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">beer</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">_external</span><span class="o">=</span><span class="bp">True</span><span class="p">)}</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/beers/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="edit_beer"><a class="viewcode-back" href="../../app.html#app.routes.edit_beer">[docs]</a><span class="k">def</span> <span class="nf">edit_beer</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Edit an existing beer in the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/beers/&lt;beer_id&gt;</span>
<span class="sd">    |  **Method:** PUT</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>
<span class="sd">    |  **Optional Data:** brewer, ibu, calories, brew_location, glass_type, brewer, style, abv</span>

<span class="sd">    Example:</span>

<span class="sd">    *Change the abv value of beer with id# 23 to 3.4* ::</span>

<span class="sd">      PUT http://domain.tld/beer/api/v0.1/beers/23</span>
<span class="sd">      data={&quot;abv&quot;:3.4}</span>

<span class="sd">    *Change the style and brew_location of beer with id# 6* ::</span>

<span class="sd">      PUT http://domain.tld/beer/api/v0.1/beers/6</span>
<span class="sd">      data={&quot;style&quot;:&quot;Pale Ale&quot;, &quot;brew_location&quot;:&quot;Milwaukee, WI&quot;}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;brewer&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;brewer&#39;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;ibu&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;ibu&#39;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;calories&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;calories&#39;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;abv&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;abv&#39;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;style&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;brew_location&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;brew_location&#39;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">b</span><span class="o">.</span><span class="n">name</span>
    <span class="n">brewer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;brewer&#39;</span><span class="p">)</span>
    <span class="n">ibu</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ibu&#39;</span><span class="p">)</span>
    <span class="n">calories</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;calories&#39;</span><span class="p">)</span>
    <span class="n">abv</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;abv&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">b</span><span class="o">.</span><span class="n">abv</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">b</span><span class="o">.</span><span class="n">style</span>
    <span class="n">brew_location</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;brew_location&#39;</span><span class="p">)</span>
    <span class="n">glass_type_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;glass_type&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">b</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Beer with new name already exists&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">glass_type_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">Glass</span><span class="o">.</span><span class="n">id_or_uri_check</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">glass_type_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">gid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid glass_type specified&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">glass_type_id</span> <span class="o">=</span> <span class="n">gid</span>
    <span class="k">if</span> <span class="n">brewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">brewer</span> <span class="o">=</span> <span class="n">brewer</span>
    <span class="k">if</span> <span class="n">ibu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">ibu</span> <span class="o">=</span> <span class="n">ibu</span>
    <span class="k">if</span> <span class="n">calories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">calories</span> <span class="o">=</span> <span class="n">calories</span>
    <span class="k">if</span> <span class="n">abv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">abv</span> <span class="o">=</span> <span class="n">abv</span>
    <span class="k">if</span> <span class="n">style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
    <span class="k">if</span> <span class="n">brew_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">brew_location</span> <span class="o">=</span> <span class="n">brew_location</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Beer updated successfully&#39;</span><span class="p">,</span> <span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="n">b</span><span class="o">.</span><span class="n">serialize</span><span class="p">()})</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/beers/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span> <span class="p">[</span><span class="s">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="delete_beer"><a class="viewcode-back" href="../../app.html#app.routes.delete_beer">[docs]</a><span class="k">def</span> <span class="nf">delete_beer</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Remove a particular beer from the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/beers/&lt;beer_id&gt;</span>
<span class="sd">    |  **Method:** DELETE</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>

<span class="sd">    Example:</span>

<span class="sd">    *Delete the beer with id# 4* ::</span>

<span class="sd">      DELETE http://domain.tld/beer/api/v0.1/beers/4</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Beer deleted successfully&#39;</span><span class="p">})</span>




<span class="c"># Review model routes</span></div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/reviews&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="list_reviews"><a class="viewcode-back" href="../../app.html#app.routes.list_reviews">[docs]</a><span class="k">def</span> <span class="nf">list_reviews</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Return a list of all reviews in the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/reviews</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** sort_by=&lt;column_name&gt; &lt;desc&gt;</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Examples:</span>

<span class="sd">    *List all reviews in the system* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/reviews</span>

<span class="sd">    *List reviews sorted by aroma rating* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/reviews?sort_by=aroma</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sort_by&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reviews</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">OperationalError</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid sorting value specified&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reviews</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reviews</span><span class="p">])</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/reviews/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="get_review"><a class="viewcode-back" href="../../app.html#app.routes.get_review">[docs]</a><span class="k">def</span> <span class="nf">get_review</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return data about a specific review.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/reviews/&lt;review_id&gt;</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Example:</span>

<span class="sd">    *Get data about review with id# 5* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/reviews/5</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/reviews&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="create_review"><a class="viewcode-back" href="../../app.html#app.routes.create_review">[docs]</a><span class="k">def</span> <span class="nf">create_review</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Post a new review to the database. Return the review object.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/reviews</span>
<span class="sd">    |  **Method:** POST</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>
<span class="sd">    |  **Expected Data:** beer_id, aroma, appearance, taste, palate, bottle_style</span>

<span class="sd">    Example:</span>

<span class="sd">    *Review beer with id# 4 with scores, 3, 3, 8, 4, 1* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/reviews</span>
<span class="sd">      data={&quot;beer_id&quot;:4, &quot;aroma&quot;:3, &quot;appearance&quot;:3, &quot;taste&quot;:8, &quot;palate&quot;:4, &quot;bottle_style&quot;:1}</span>

<span class="sd">    *Review beer with id# 2 with scores, 1, 1, 5, 5, 5* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/reviews</span>
<span class="sd">      data={&quot;aroma&quot;:&quot;1&quot;, &quot;appearance&quot;:&quot;1&quot;, &quot;taste&quot;:&quot;5&quot;, &quot;palate&quot;:&quot;5&quot;, &quot;bottle_style&quot;:&quot;5&quot;, &quot;beer_id&quot;:&quot;http://domain.tld/beer/api/v0.1/beers/2&quot;}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">score</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">score</span><span class="p">[</span><span class="s">&#39;aroma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;aroma&#39;</span><span class="p">)</span>
    <span class="n">score</span><span class="p">[</span><span class="s">&#39;appearance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;appearance&#39;</span><span class="p">)</span>
    <span class="n">score</span><span class="p">[</span><span class="s">&#39;taste&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;taste&#39;</span><span class="p">)</span>
    <span class="n">score</span><span class="p">[</span><span class="s">&#39;palate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;palate&#39;</span><span class="p">)</span>
    <span class="n">score</span><span class="p">[</span><span class="s">&#39;bottle_style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;bottle_style&#39;</span><span class="p">)</span>
    <span class="n">score</span><span class="p">[</span><span class="s">&#39;beer_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&#39;beer_id&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">score</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Missing value for &#39;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;beer_id&#39;</span><span class="p">:</span>
            <span class="n">bid</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">id_or_uri_check</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">bid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;That beer does not exist, please create it first&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
                <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
            <span class="c"># Has user reviewed that beer this week?</span>
            <span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">reviews</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">review</span><span class="o">.</span><span class="n">beer_id</span> <span class="o">==</span> <span class="n">bid</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">review</span><span class="o">.</span><span class="n">created_on</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;You have already reviewed that beer this week!&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
                        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Review</span><span class="o">.</span><span class="n">validate_score_values</span><span class="p">(</span><span class="n">score</span><span class="p">):</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid score data, please try again&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">review</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">review</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="n">review</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span> \
            <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Review created successfully&#39;</span><span class="p">}),</span> <span class="mi">201</span><span class="p">,</span> \
            <span class="p">{</span><span class="s">&#39;Location&#39;</span><span class="p">:</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&#39;get_review&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">review</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">_external</span><span class="o">=</span><span class="bp">True</span><span class="p">)})</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/reviews/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="edit_review"><a class="viewcode-back" href="../../app.html#app.routes.edit_review">[docs]</a><span class="k">def</span> <span class="nf">edit_review</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Edit an existing review.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/reviews/&lt;review_id&gt;</span>
<span class="sd">    |  **Method:** PUT </span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>
<span class="sd">    |  **Optional Data:** aroma, appearance, taste, palate, bottle_style</span>

<span class="sd">    Example:</span>

<span class="sd">    *Change the aroma score to &#39;5&#39; on review with id# 3* ::</span>

<span class="sd">      PUT http://domain.tld/beer/api/v0.1/reviews/3</span>
<span class="sd">      data={&quot;aroma&quot;:5}</span>

<span class="sd">    *Change the scores of review with id# 1* ::</span>

<span class="sd">      PUT http://domain.tld/beer/api/v0.1/reviews/1</span>
<span class="sd">      data={&quot;aroma&quot;:&quot;5&quot;, &quot;appearance&quot;:&quot;1&quot;, &quot;taste&quot;:&quot;3&quot;, &quot;palate&quot;:&quot;3&quot;, &quot;bottle_style&quot;:&quot;2&quot;}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">validate_score_values</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Unable to validate new scores&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">update_score_values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">serialize</span><span class="p">(),</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Review updated successfully&#39;</span><span class="p">}))</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/reviews/&lt;int:id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="delete_review"><a class="viewcode-back" href="../../app.html#app.routes.delete_review">[docs]</a><span class="k">def</span> <span class="nf">delete_review</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Delete a review from the database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/reviews/&lt;review_id&gt;</span>
<span class="sd">    |  **Method:** DELETE</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>

<span class="sd">    Example:</span>

<span class="sd">    *Delete the review with id# 3* ::</span>

<span class="sd">      DELETE http://domain.tld/beer/api/v0.1/reviews/3</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Review deleted successfully&#39;</span><span class="p">})</span>

<span class="c"># Favorites list routes</span></div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users/&lt;int:id&gt;/favorites&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<div class="viewcode-block" id="get_user_favorites"><a class="viewcode-back" href="../../app.html#app.routes.get_user_favorites">[docs]</a><span class="k">def</span> <span class="nf">get_user_favorites</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a list of users favorite beers.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users/&lt;user_id&gt;/favorites</span>
<span class="sd">    |  **Method:** GET</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** None</span>

<span class="sd">    Example:</span>

<span class="sd">    *Retrieve a list of favorites for user with id# 12* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/users/12/favorites</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">results</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">favorites</span><span class="p">])</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users/&lt;int:id&gt;/favorites&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="create_user_favorites_list"><a class="viewcode-back" href="../../app.html#app.routes.create_user_favorites_list">[docs]</a><span class="k">def</span> <span class="nf">create_user_favorites_list</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a fresh list of favorite beers for a user.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users/&lt;user_id&gt;/favorites</span>
<span class="sd">    |  **Method:** POST</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** None</span>
<span class="sd">    |  **Expected Data:** beers (list of id&#39;s)</span>

<span class="sd">    Example:</span>

<span class="sd">    *Create favorites list including beers with id#&#39;s 2, 6, 3, 19 for user with id# 5* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/users/5/favorites</span>
<span class="sd">      data={&quot;beers&quot;:[&quot;2&quot;, 6, 3, &quot;http://domain.tld/beer/api/v0.1/beers/19&quot;]}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">favorites</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;User already has a favorites list, delete it first&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s">&quot;beers&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid input, expecting </span><span class="se">\&#39;</span><span class="s">beers</span><span class="se">\&#39;</span><span class="s"> list.&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">beer</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s">&#39;beers&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Beer</span><span class="o">.</span><span class="n">id_or_uri_check</span><span class="p">(</span><span class="n">beer</span><span class="p">):</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid beer ID/URL specified&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">beer</span><span class="p">)</span>
        <span class="n">u</span><span class="o">.</span><span class="n">add_to_favorites</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&quot;results&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">favorites</span><span class="p">],</span>\
            <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Favorites list created with &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">favorites</span><span class="p">))</span>\
            <span class="o">+</span> <span class="s">&#39; beers&#39;</span><span class="p">}),</span> <span class="mi">201</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users/&lt;int:id&gt;/favorites&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="edit_user_favorites"><a class="viewcode-back" href="../../app.html#app.routes.edit_user_favorites">[docs]</a><span class="k">def</span> <span class="nf">edit_user_favorites</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add or remove a particular beer from a users favorites list.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users/&lt;user_id&gt;/favorites</span>
<span class="sd">    |  **Method:** PUT</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>
<span class="sd">    |  **Expected Data:** beer, action</span>

<span class="sd">    Example:</span>

<span class="sd">    *Add beer with id# 8 to user with id# 3* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/users/3/favorites</span>
<span class="sd">      data={&quot;beer&quot;:8, &quot;action&quot;:&quot;add&quot;}</span>

<span class="sd">    *Remove beer with id# 2 from user with id# 3* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/users/3/favorites</span>
<span class="sd">      data={&quot;beer&quot;:&quot;http://www.domain.tld/beer/api/v0.1/beers/2&quot;, &quot;action&quot;:&quot;remove&quot;}</span>

<span class="sd">    *Add a beer with id# 71 to user with id# 12* ::</span>

<span class="sd">      POST http://domain.tld/beer/api/v0.1/users/12/favorites</span>
<span class="sd">      data={&quot;beer&quot;:71, &quot;action&quot;:&quot;add&quot;}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="s">&#39;remove&#39;</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">)</span>
    <span class="n">beer_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;beer&#39;</span><span class="p">)</span>
    <span class="n">beer</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">id_or_uri_check</span><span class="p">(</span><span class="n">beer_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid action specified (try add/remove)&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">beer</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;That beer doesn</span><span class="se">\&#39;</span><span class="s">t exist, create it first!&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">beer</span> <span class="o">=</span> <span class="n">Beer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">beer</span><span class="p">)</span>
    <span class="n">exists</span> <span class="o">=</span> <span class="p">(</span><span class="bp">True</span> <span class="k">if</span> <span class="n">beer</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">favorites</span> <span class="k">else</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Beer already on the favorite list&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="n">u</span><span class="o">.</span><span class="n">add_to_favorites</span><span class="p">(</span><span class="n">beer</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;remove&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Beer wasn</span><span class="se">\&#39;</span><span class="s">t on the favorite list anyway&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
        <span class="n">u</span><span class="o">.</span><span class="n">remove_from_favorites</span><span class="p">(</span><span class="n">beer</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">favorites</span><span class="p">],</span>\
            <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="o">+</span><span class="n">beer</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="p">(</span><span class="s">&#39;added to&#39;</span> <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span>\
            <span class="k">else</span> <span class="s">&#39;removed from&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; favorites&#39;</span><span class="p">})</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/users/&lt;int:id&gt;/favorites&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="delete_users_favorites_list"><a class="viewcode-back" href="../../app.html#app.routes.delete_users_favorites_list">[docs]</a><span class="k">def</span> <span class="nf">delete_users_favorites_list</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Delete a users entire favorites list.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/users/&lt;user_id&gt;/favorites</span>
<span class="sd">    |  **Method:** DELETE</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>

<span class="sd">    Example:</span>

<span class="sd">    *Delete favorites list for user with id# 4* ::</span>

<span class="sd">      DELETE http://domain.tld/beer/api/v0.1/users/4/favorites</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">favorites</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Favorites list was already empty&#39;</span><span class="p">})</span>
    <span class="n">u</span><span class="o">.</span><span class="n">favorites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;Favorites list deleted successfully&#39;</span><span class="p">})</span>
</div>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/beer/api/v0.1/favorites&#39;</span><span class="p">,</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<span class="nd">@auth.login_required</span>
<div class="viewcode-block" id="list_all_user_favorites"><a class="viewcode-back" href="../../app.html#app.routes.list_all_user_favorites">[docs]</a><span class="k">def</span> <span class="nf">list_all_user_favorites</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; List favorites list for each user in database.</span>

<span class="sd">    |  **URL:** /beer/api/v0.1/favorites</span>
<span class="sd">    |  **METHOD:** GET</span>
<span class="sd">    |  **Query Args:** None</span>
<span class="sd">    |  **Authentication:** Token/Password</span>

<span class="sd">    Example:</span>

<span class="sd">    *Get all favorites-list in system* ::</span>

<span class="sd">      GET http://domain.tld/beer/api/v0.1/favorites</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&#39;results&#39;</span><span class="p">:</span> \
            <span class="p">[{</span><span class="n">u</span><span class="o">.</span><span class="n">username</span><span class="p">:</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">favorites</span><span class="p">]}</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]})</span>


    
</div>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">*** Authentication</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="nd">@auth.verify_password</span>
<span class="k">def</span> <span class="nf">verify_password</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns true if hash of plaintext &#39;password&#39; equals stored password hash for user. &quot;&quot;&quot;</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">check_auth_token</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">check_password</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="nd">@app.before_request</span>
<div class="viewcode-block" id="before_request"><a class="viewcode-back" href="../../app.html#app.routes.before_request">[docs]</a><span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Checks for *Content-Type: application/json* on all POST/PUT/DELETE routes. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s">&quot;GET&quot;</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">flash</span><span class="p">(</span><span class="s">u&#39;Invalid request, expecting JSON&#39;</span><span class="p">)</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
</div>
<span class="nd">@app.after_request</span>
<div class="viewcode-block" id="after_request"><a class="viewcode-back" href="../../app.html#app.routes.after_request">[docs]</a><span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Update a users last_activity field after each authenticated api request. &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s">&#39;user&#39;</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">last_activity</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">response</span>


</div>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">*** Error Handling</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<div class="viewcode-block" id="malformed_error"><a class="viewcode-back" href="../../app.html#app.routes.malformed_error">[docs]</a><span class="k">def</span> <span class="nf">malformed_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a 400 error when recieving a malformed request. Adds any messages that have been flash()&#39;ed. &quot;&quot;&quot;</span>

    <span class="n">messages</span> <span class="o">=</span> <span class="n">get_flashed_messages</span><span class="p">(</span><span class="n">with_categories</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">messages</span><span class="p">:</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span> 
        <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
            <span class="c">#TODO: Could be cleaner, multiple messages would overwrite</span>
            <span class="n">errors</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> <span class="mi">400</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="s">&quot;400: Malformed request&quot;</span><span class="p">}),</span> <span class="mi">400</span>
</div>
<span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<div class="viewcode-block" id="not_found_error"><a class="viewcode-back" href="../../app.html#app.routes.not_found_error">[docs]</a><span class="k">def</span> <span class="nf">not_found_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a 404 error, usually when &lt;int:id&gt; in the route is not a valid id# for that model. &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="s">&quot;404: Not Found&quot;</span><span class="p">}),</span> <span class="mi">404</span>
</div>
<span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">405</span><span class="p">)</span>
<div class="viewcode-block" id="method_unallowed_error"><a class="viewcode-back" href="../../app.html#app.routes.method_unallowed_error">[docs]</a><span class="k">def</span> <span class="nf">method_unallowed_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a 405 error when an unsupported HTTP method is used on an endpoint. &quot;&quot;&quot;</span> 

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="s">&quot;405: Method not allowed&quot;</span><span class="p">}),</span> <span class="mi">405</span>
</div>
<span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<div class="viewcode-block" id="internal_error"><a class="viewcode-back" href="../../app.html#app.routes.internal_error">[docs]</a><span class="k">def</span> <span class="nf">internal_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a 500 error when something goes terribly wrong. &quot;&quot;&quot;</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="s">&quot;500: The application is drunk&quot;</span><span class="p">}),</span> <span class="mi">500</span>
</div>
<span class="nd">@auth.error_handler</span>
<div class="viewcode-block" id="unauthorized_error"><a class="viewcode-back" href="../../app.html#app.routes.unauthorized_error">[docs]</a><span class="k">def</span> <span class="nf">unauthorized_error</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Returns a 403 error when attempting to access data without authorization. &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">jsonify</span><span class="p">({</span><span class="s">&quot;error&quot;</span><span class="p">:</span> <span class="s">&quot;Unauthorized access&quot;</span><span class="p">}),</span> <span class="mi">403</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">beer-api  documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Brandon Cornejo.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>